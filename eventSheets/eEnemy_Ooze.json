{
	"name": "eEnemy_Ooze",
	"events": [
		{
			"eventType": "group",
			"disabled": false,
			"title": "Green Ooze",
			"description": "",
			"isActiveOnStart": true,
			"children": [
				{
					"eventType": "comment",
					"text": "Passive"
				},
				{
					"eventType": "variable",
					"name": "actionType",
					"type": "string",
					"initialValue": "\"none\"",
					"comment": "Parsed action type (hop, idle, walk, attack)",
					"isStatic": false,
					"isConstant": false,
					"sid": 791762697534150
				},
				{
					"eventType": "variable",
					"name": "maskUid",
					"type": "number",
					"initialValue": "0",
					"comment": "UID of the enemy mask for animations",
					"isStatic": false,
					"isConstant": false,
					"sid": 415850569424747
				},
				{
					"eventType": "variable",
					"name": "animName",
					"type": "string",
					"initialValue": "",
					"comment": "Animation name to play",
					"isStatic": false,
					"isConstant": false,
					"sid": 383210336283353
				},
				{
					"eventType": "variable",
					"name": "vectorX",
					"type": "number",
					"initialValue": "0",
					"comment": "Movement vector X component",
					"isStatic": false,
					"isConstant": false,
					"sid": 947431780742065
				},
				{
					"eventType": "variable",
					"name": "vectorY",
					"type": "number",
					"initialValue": "0",
					"comment": "Movement vector Y component",
					"isStatic": false,
					"isConstant": false,
					"sid": 549351656837192
				},
				{
					"eventType": "variable",
					"name": "oozeBaseUid",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 878594619305355
				},
				{
					"eventType": "variable",
					"name": "aiResult",
					"type": "string",
					"initialValue": "\"none\"",
					"comment": "AI update result string containing action type and parameters (format: action|maskUid|animation|vectorX|vectorY)",
					"isStatic": false,
					"isConstant": false,
					"sid": 711103871595748
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "on-created",
							"objectClass": "En_Ooze_Base",
							"sid": 348031258120377
						}
					],
					"actions": [
						{
							"id": "set-instvar-value",
							"objectClass": "En_Ooze_Base",
							"sid": 922427718389052,
							"parameters": {
								"instance-variable": "Pair_ID",
								"value": "En_Ooze_Mask.UID"
							}
						},
						{
							"type": "script",
							"language": "typescript",
							"script": [
								"// Add this line at the very beginning to see if it's being called",
								"console.log(\"Ooze initialization triggered\");",
								"",
								"if (!(globalThis as any).enemyData) {",
								"  (globalThis as any).enemyData = new Map();",
								"}",
								"",
								"const enemy = runtime.objects.En_Ooze_Base.getPickedInstances()[0];",
								"const mask = runtime.objects.En_Ooze_Mask.getPickedInstances()[0];",
								"",
								"if (enemy && mask) {",
								"  (globalThis as any).enemyData.set(enemy.uid, {",
								"    maskUid: mask.uid,",
								"    type: \"Ooze\",",
								"    state: \"Idle\", ",
								"    stateTimer: Math.floor(Math.random() * 60),",
								"    direction: enemy.instVars.Direction || \"Down\"",
								"  });",
								"  ",
								"  console.log(`Initialized Ooze AI: enemy=${enemy.uid}, mask=${mask.uid}`);",
								"} else {",
								"  console.log(\"Failed to find enemy or mask instances\");",
								"}"
							]
						}
					],
					"sid": 512817471739874
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "every-tick",
							"objectClass": "System",
							"sid": 649306619588397
						}
					],
					"actions": [
						{
							"id": "set-position",
							"objectClass": "En_Ooze_Mask",
							"sid": 558401990920895,
							"parameters": {
								"x": "En_Ooze_Base.X",
								"y": "En_Ooze_Base.Y"
							}
						}
					],
					"sid": 488996314981429
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "for-each",
							"objectClass": "System",
							"sid": 344898266000500,
							"parameters": {
								"object": "En_Ooze_Base"
							}
						}
					],
					"actions": [
						{
							"type": "script",
							"language": "typescript",
							"script": [
								"console.log(\"Ooze update triggered\");",
								"",
								"const enemyData = (globalThis as any).enemyData;",
								"if (!enemyData) return;",
								"",
								"const enemy = runtime.objects.En_Ooze_Base.getPickedInstances()[0];",
								"const player = runtime.objects.Player_Base.getFirstInstance();",
								"if (!enemy || !player) return;",
								"",
								"const data = enemyData.get(enemy.uid);",
								"if (!data) return;",
								"",
								"console.log(`Ooze ${enemy.uid}: state=${data.state}, timer=${data.stateTimer}`);",
								"",
								"// Decrement timer",
								"data.stateTimer = Math.max(0, data.stateTimer - 1);",
								"",
								"// Calculate angle to player (used in multiple places)",
								"const angle = Math.atan2(player.y - enemy.y, player.x - enemy.x);",
								"const angleDeg = ((angle * 180 / Math.PI) + 360) % 360;",
								"",
								"// Update direction",
								"if (angleDeg >= 315 || angleDeg < 45) data.direction = \"Right\";",
								"else if (angleDeg >= 45 && angleDeg < 135) data.direction = \"Down\";",
								"else if (angleDeg >= 135 && angleDeg < 225) data.direction = \"Left\";",
								"else data.direction = \"Up\";",
								"",
								"// STATE TRANSITIONS",
								"  if (data.state === \"Idle\" && data.stateTimer <= 0) {",
								"      console.log(\"Ooze starting hop\");",
								"      data.state = \"Hop\";",
								"      data.stateTimer = 60 + Math.floor(Math.random() * 60);",
								"      ",
								"      try {",
								"          runtime.callFunction(\"Set_Animation\", data.maskUid, `Hop_${data.direction}`);",
								"          console.log(`Set hop animation: Hop_${data.direction}`);",
								"      } catch (error) {",
								"          console.log(\"Hop animation error:\", error);",
								"      }",
								"  }",
								"  else if (data.state === \"Hop\" && data.stateTimer <= 0) {",
								"      console.log(\"Ooze returning to idle\");",
								"      data.state = \"Idle\";",
								"      data.stateTimer = 100 + Math.floor(Math.random() * 30);",
								"      ",
								"      try {",
								"          runtime.callFunction(\"Set_Animation\", data.maskUid, `Idle_${data.direction}`);",
								"      } catch (error) {",
								"          console.log(\"Idle animation error:\", error);",
								"      }",
								"  }",
								"  ",
								"",
								"",
								"",
								"// CONTINUOUS MOVEMENT BASED ON CURRENT STATE",
								"try {",
								"    for (const inst of runtime.objects.En_Ooze_Base.instances()) {",
								"        if (inst.uid === enemy.uid) {",
								"            if (data.state === \"Hop\") {",
								"                // Only start fast movement after a brief wind-up (first 10 frames of hop)",
								"                if (data.stateTimer < (90 + 60 - 10)) {",
								"                    // FAST aggressive movement during hop",
								"                    const hopSpeed = 80;",
								"                    inst.behaviors[\"8Direction\"].vectorX = Math.cos(angle) * hopSpeed;",
								"                    inst.behaviors[\"8Direction\"].vectorY = Math.sin(angle) * hopSpeed;",
								"                    ",
								"                    // Keep hop animation playing every frame during fast movement",
								"                    try {",
								"                        runtime.callFunction(\"Set_Animation\", data.maskUid, `Hop_${data.direction}`);",
								"                    } catch (error) {",
								"                        console.log(\"Hop animation maintenance error:\", error);",
								"                    }",
								"                    ",
								"                    console.log(`Hopping aggressively at speed ${hopSpeed}`);",
								"                } else {",
								"                    // Brief pause at start of hop for animation wind-up",
								"                    const creepSpeed = 15;",
								"                    inst.behaviors[\"8Direction\"].vectorX = Math.cos(angle) * creepSpeed;",
								"                    inst.behaviors[\"8Direction\"].vectorY = Math.sin(angle) * creepSpeed;",
								"                }",
								"            } else {",
								"                // SLOW creeping movement during idle",
								"                const creepSpeed = 15;",
								"                inst.behaviors[\"8Direction\"].vectorX = Math.cos(angle) * creepSpeed;",
								"                inst.behaviors[\"8Direction\"].vectorY = Math.sin(angle) * creepSpeed;",
								"            }",
								"            ",
								"            break;",
								"        }",
								"    }",
								"} catch (error) {",
								"    console.log(\"Movement error:\", error);",
								"}",
								"",
								"// Update local variable for debugging",
								"localVars.aiResult = `${data.state}_${data.stateTimer}`;"
							]
						}
					],
					"sid": 579447741897645,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 339195626692091,
									"parameters": {
										"first-value": "aiResult",
										"comparison": 1,
										"second-value": "\"none\""
									}
								}
							],
							"actions": [
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 176963518535662,
									"parameters": {
										"variable": "actionType",
										"value": "tokenat(aiResult, 0, \"|\")"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 479035020853428,
									"parameters": {
										"variable": "maskUid",
										"value": "int(tokenat(aiResult, 1, \"|\"))"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 926495954297604,
									"parameters": {
										"variable": "oozeBaseUid",
										"value": "int(tokenat(aiResult, 5, \"|\"))"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 380565829356399,
									"parameters": {
										"variable": "animName",
										"value": "tokenat(aiResult, 2, \"|\")"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 372840257909830,
									"parameters": {
										"variable": "vectorX",
										"value": "float(tokenat(aiResult, 3, \"|\"))"
									}
								},
								{
									"id": "set-eventvar-value",
									"objectClass": "System",
									"sid": 361143718255549,
									"parameters": {
										"variable": "vectorY",
										"value": "float(tokenat(aiResult, 4, \"|\"))"
									}
								},
								{
									"type": "script",
									"language": "typescript",
									"script": [
										"console.log(\"=== ACTION HANDLING ===\");",
										"console.log(\"actionType:\", localVars.actionType);",
										"console.log(\"maskUid:\", localVars.maskUid);",
										"console.log(\"animName:\", localVars.animName); ",
										"console.log(\"vectorX:\", localVars.vectorX);",
										"console.log(\"vectorY:\", localVars.vectorY);",
										"console.log(\"=== END ACTION HANDLING ===\");"
									]
								}
							],
							"sid": 494877073908695,
							"children": [
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 254410476537107,
											"parameters": {
												"first-value": "actionType",
												"comparison": 0,
												"second-value": "\"idle\""
											}
										}
									],
									"actions": [
										{
											"callFunction": "Set_Animation",
											"sid": 129980685152659,
											"parameters": [
												"maskUid",
												"animName"
											]
										}
									],
									"sid": 302042306655711,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "pick-by-comparison",
													"objectClass": "System",
													"sid": 648233966172319,
													"parameters": {
														"object": "En_Ooze_Base",
														"expression": "En_Ooze_Base.UID",
														"comparison": 0,
														"value": "int(tokenat(aiResult, 1, \"|\"))"
													}
												}
											],
											"actions": [
												{
													"id": "set-vector-x",
													"objectClass": "En_Ooze_Base",
													"sid": 443152348924013,
													"behaviorType": "8Direction",
													"parameters": {
														"vector-x": "0"
													}
												},
												{
													"id": "set-vector-y",
													"objectClass": "En_Ooze_Base",
													"sid": 663203446095424,
													"behaviorType": "8Direction",
													"parameters": {
														"vector-y": "0"
													}
												}
											],
											"sid": 877079439126580
										}
									]
								},
								{
									"eventType": "block",
									"conditions": [
										{
											"id": "compare-two-values",
											"objectClass": "System",
											"sid": 559503709303465,
											"parameters": {
												"first-value": "actionType",
												"comparison": 0,
												"second-value": "\"hop\""
											}
										}
									],
									"actions": [
										{
											"callFunction": "Set_Animation",
											"sid": 884029846897177,
											"parameters": [
												"maskUid",
												"animName"
											]
										},
										{
											"type": "script",
											"language": "typescript",
											"script": [
												"console.log(\"HOP ACTION TRIGGERED!\");",
												"console.log(\"Setting vectors:\", localVars.vectorX, localVars.vectorY);"
											]
										}
									],
									"sid": 819450226702443,
									"children": [
										{
											"eventType": "block",
											"conditions": [
												{
													"id": "pick-by-comparison",
													"objectClass": "System",
													"sid": 701824700288902,
													"parameters": {
														"object": "En_Ooze_Base",
														"expression": "En_Ooze_Base.UID",
														"comparison": 0,
														"value": "oozeBaseUid"
													}
												}
											],
											"actions": [
												{
													"id": "set-vector-x",
													"objectClass": "En_Ooze_Base",
													"sid": 603660555452792,
													"behaviorType": "8Direction",
													"parameters": {
														"vector-x": "vectorX"
													}
												},
												{
													"id": "set-vector-y",
													"objectClass": "En_Ooze_Base",
													"sid": 837475344839874,
													"behaviorType": "8Direction",
													"parameters": {
														"vector-y": "vectorY"
													}
												}
											],
											"sid": 144158971152752
										}
									]
								}
							]
						}
					]
				}
			],
			"sid": 543546649379716
		}
	],
	"sid": 385949953741632
}